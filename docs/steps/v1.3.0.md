# WalletWise v1.3.0

> Correcciones Post-Testing y Mejoras de UX

**Version:** 1.3.0
**Estado:** Completado
**Fecha:** Enero 2026

---

## Descripcion

Version 1.3.0 corrige bugs encontrados durante testing de v1.2.0 e implementa mejoras de UX.

**Total: 24 correcciones organizadas en 13 fases - TODAS COMPLETADAS**

---

## Cambios Implementados

### Fase 1: Simplificar Criptomonedas

| Cambio        | Descripcion                                   | Estado     |
| ------------- | --------------------------------------------- | ---------- |
| Solo USDT     | Eliminar BTC, ETH, BNB, SOL de sincronizacion | Completado |
| Pares Binance | USDT-VES, USDT-COP (NO USDT-USD)              | Completado |
| USDT-USD fijo | Mantener tasa 1:1                             | Completado |

### Fase 2: Monedas y Simbolos

| Cambio            | Descripcion                              | Estado     |
| ----------------- | ---------------------------------------- | ---------- |
| Simbolos = codigo | USD->USD, VES->VES, COP->COP, USDT->USDT | Completado |
| Editar simbolos   | Pagina/modal para editar simbolos        | Completado |
| Botones sync      | Deshabilitar + mostrar fecha disponible  | Completado |
| Formato fecha     | Usar formato del usuario                 | Completado |

### Fase 3: Fix Inventario

| Cambio               | Descripcion                             | Estado     |
| -------------------- | --------------------------------------- | ---------- |
| categoryId null      | Fix schema POST para permitir null      | Completado |
| Validacion servicio  | No validar si categoryId es null        | Completado |
| Preseleccion edicion | Fix selects (unidad, categoria, moneda) | Completado |
| Precio default       | Default 0 si no se ingresa              | Completado |

### Fase 4: Fix Modelo de Presupuestos

| Cambio                | Descripcion                          | Estado     |
| --------------------- | ------------------------------------ | ---------- |
| Bloqueo sin mover     | Contribuir NO resta del balance      | Completado |
| Withdraw sin mover    | Retirar NO suma al balance           | Completado |
| targetAmount opcional | Opcional en schema POST              | Completado |
| Schema Prisma         | targetAmount nullable                | Completado |
| Form sin objetivo     | Permitir budget sin objetivo         | Completado |
| Ocultar barra         | Si no hay objetivo, no mostrar barra | Completado |

### Fase 5: Fix Conversiones

| Cambio             | Descripcion                    | Estado     |
| ------------------ | ------------------------------ | ---------- |
| KPIs tasas custom  | Usar tasa de cada transaccion  | Completado |
| Funcion conversion | Nueva funcion con tasas custom | Completado |
| Totales cuentas    | Usar tasas custom              | Completado |
| Columna Balance    | Usar tasas custom              | Completado |
| Formula Total      | Total = Disponible + Bloqueado | Completado |

### Fase 6: Formularios Globales

| Cambio              | Descripcion                            | Estado     |
| ------------------- | -------------------------------------- | ---------- |
| Inputs number       | Sin valor 0, usar placeholder          | Completado |
| Form gastos         | Fix preseleccion en edicion            | Completado |
| Form ingresos       | Fix preseleccion en edicion            | Completado |
| Form trabajos       | Fix preseleccion en edicion            | Completado |
| Form transferencias | Fix preseleccion en edicion            | Completado |
| Form presupuestos   | Fix preseleccion en edicion            | Completado |
| Dia pago opcional   | Hacer dia de pago opcional en trabajos | Completado |

### Fase 7: Categorias

| Cambio            | Descripcion                        | Estado     |
| ----------------- | ---------------------------------- | ---------- |
| Icono opcional    | Hacer icono opcional en schema     | Completado |
| Sin icono default | Quitar icono por defecto           | Completado |
| Solo texto        | Mostrar solo texto si no hay icono | Completado |
| Layout ajustado   | Ajustar para categorias sin icono  | Completado |

### Fase 8: Account Types CRUD

| Cambio          | Descripcion                    | Estado     |
| --------------- | ------------------------------ | ---------- |
| Estado activo   | Por defecto activo en seed     | Completado |
| POST endpoint   | Crear tipo de cuenta           | Completado |
| PUT endpoint    | Editar tipo de cuenta          | Completado |
| DELETE endpoint | Eliminar con validacion        | Completado |
| Formulario      | Crear formulario de tipo       | Completado |
| Modal mover     | Mover cuentas al eliminar tipo | Completado |
| Botones tabla   | Editar/eliminar en tabla       | Completado |

### Fase 9: Historial de Precios

| Cambio            | Descripcion                     | Estado     |
| ----------------- | ------------------------------- | ---------- |
| Explicacion       | Seccion explicativa             | Completado |
| Grafico tendencia | Grafico de precios por producto | Completado |
| Filtro producto   | Filtrar por producto en grafico | Completado |

### Fase 10: Shopping List Exportacion

| Cambio          | Descripcion                      | Estado     |
| --------------- | -------------------------------- | ---------- |
| PDF             | Exportar con conversion          | Completado |
| WhatsApp        | Compartir formato detallado      | Completado |
| Formato mensaje | "- Producto: X unidad x $Y = $Z" | Completado |

### Fase 11: Historial Transacciones

| Cambio         | Descripcion                             | Estado     |
| -------------- | --------------------------------------- | ---------- |
| Endpoint       | GET /api/transactions/history           | Completado |
| Combinar tipos | Ingresos, gastos, transfers, budgets    | Completado |
| Pagina         | Nueva pagina historial                  | Completado |
| Filtros        | Fechas, tipo, cuenta, categoria, moneda | Completado |
| Paginacion     | Igual que otras paginas                 | Completado |
| Sidebar        | Link en sidebar                         | Completado |

### Fase 12: Dashboard Fixes

| Cambio              | Descripcion                    | Estado     |
| ------------------- | ------------------------------ | ---------- |
| Donut dark mode     | Fix texto oscuro               | Completado |
| Orden transacciones | Por createdAt DESC             | Completado |
| Selector orden      | Mas recientes, antiguas, monto | Completado |
| Multiselect tasas   | Hasta 5 monedas                | Completado |
| Toggle lineas       | Mostrar/ocultar cada moneda    | Completado |

### Fase 13: Sidebar Personalizacion

| Cambio         | Descripcion                 | Estado     |
| -------------- | --------------------------- | ---------- |
| UI reordenar   | En settings                 | Completado |
| Flechas        | Arriba/abajo para cada item | Completado |
| Guardar orden  | En UserConfig.sidebarConfig | Completado |
| Leer orden     | En sidebar component        | Completado |
| Quitar mensaje | Quitar "proximamente"       | Completado |

---

## Decisiones de Diseno

### Criptomonedas

- Solo USDT como cripto soportada
- USDT-USD siempre 1:1 (no sincronizar)
- Sincronizar solo USDT-VES y USDT-COP desde Binance

### Modelo de Presupuestos

- Contribuir/retirar NO mueve dinero de la cuenta
- El dinero se "bloquea" pero sigue en la cuenta
- Formula: `Total = Disponible + Bloqueado`

### Conversiones

- Dashboard y cuentas usan tasas custom de cada transaccion
- Fallback: si no hay tasa custom, usar tasa de BD

### Formularios

- Inputs number sin valor por defecto (placeholder)
- Selects preseleccionados en TODOS los forms de edicion
- Icono de categoria opcional
- Dia de pago de trabajo opcional

### Account Types

- CRUD completo (crear, editar, eliminar)
- Estado activo por defecto
- Al eliminar con cuentas asociadas: pedir mover a otro tipo

### Exportacion Shopping List

- PDF con columnas completas + conversion
- WhatsApp: "- Producto: X unidad x $Y = $Z" + total

### Historial Transacciones

- Incluye: Ingresos, Gastos, Transferencias, Contribuciones, Retiros
- Filtros: Fechas, tipo, cuenta, categoria, moneda
- Paginacion igual que otras paginas

### Dashboard

- Orden transacciones: createdAt DESC + selector
- Historial tasas: multiselect hasta 5 monedas con toggle

### Sidebar

- Reordenar con flechas (no drag & drop)
- Guardar en UserConfig.sidebarConfig

---

## Schema Updates

```prisma
model Budget {
  // ... campos existentes
  targetAmount  Decimal?     @db.Decimal(18, 2)  // Ahora nullable
}
```

---

## Archivos Nuevos

| Archivo                                                         | Descripcion        |
| --------------------------------------------------------------- | ------------------ |
| `app/api/transactions/history/route.ts`                         | Endpoint historial |
| `app/api/transactions/history/service.ts`                       | Servicio historial |
| `app/dashboard/transactions/history/page.tsx`                   | Pagina historial   |
| `app/dashboard/account-types/_components/account-type-form.tsx` | Form tipo cuenta   |
| `app/dashboard/settings/_components/sidebar-config.tsx`         | Config sidebar     |

## Archivos Modificados

| Archivo                                                       | Cambios                         |
| ------------------------------------------------------------- | ------------------------------- |
| `lib/exchange-rates.ts`                                       | Solo USDT                       |
| `prisma/seed.ts`                                              | Simbolos, account-types activos |
| `prisma/schema.prisma`                                        | targetAmount nullable           |
| `app/api/inventory-items/schema.ts`                           | categoryId nullable             |
| `app/api/inventory-items/service.ts`                          | Validar categoryId              |
| `app/api/budgets/repository.ts`                               | Bloqueo sin mover dinero        |
| `app/api/budgets/schema.ts`                                   | targetAmount opcional           |
| `app/api/dashboard/service.ts`                                | Tasas custom, orden             |
| `app/api/accounts/service.ts`                                 | Tasas custom, formula           |
| `app/api/jobs/schema.ts`                                      | Dia pago opcional               |
| `app/api/categories/schema.ts`                                | Icono opcional                  |
| `app/api/account-types/route.ts`                              | POST endpoint                   |
| `app/api/account-types/[id]/route.ts`                         | PUT, DELETE endpoints           |
| `app/dashboard/exchange-rates/page.tsx`                       | Botones cooldown                |
| `app/dashboard/inventory/_components/inventory-item-form.tsx` | Preseleccion                    |
| `app/dashboard/budgets/_components/budget-form.tsx`           | Sin objetivo                    |
| `app/dashboard/budgets/page.tsx`                              | Ocultar barra                   |
| `app/dashboard/categories/_components/category-form.tsx`      | Sin icono default               |
| `app/dashboard/categories/page.tsx`                           | Solo texto                      |
| `app/dashboard/account-types/page.tsx`                        | CRUD UI                         |
| `app/dashboard/inventory/price-history/page.tsx`              | Explicacion, graficos           |
| `app/dashboard/inventory/shopping-list/page.tsx`              | PDF, WhatsApp                   |
| `app/dashboard/_components/expense-by-category.tsx`           | Fix dark mode                   |
| `app/dashboard/_components/recent-transactions.tsx`           | Selector orden                  |
| `app/dashboard/_components/rate-history-chart.tsx`            | Multiselect                     |
| `app/dashboard/settings/page.tsx`                             | Sidebar config                  |
| `components/layout/sidebar.tsx`                               | Leer orden                      |
| Todos los formularios                                         | Inputs sin default, selects     |

---

## Migracion

```bash
yarn db:generate
yarn db:push
```

---

_WalletWise v1.3.0 - Correcciones Post-Testing (Completado)_
